{% extends "home/userlayout.html" %}
{% load static %}


{% block head %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script> 
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">

<script>
    hljs.initHighlightingOnLoad();
</script>
{% endblock %}

{% block title %} {{file.title }} {% endblock %}

{% block body %}

<script type="text/javascript">

    var qobj = '{ "mcquestions" : [ { "options" : ["2", "3", "69", "21"], "questions" : [false, false, false, true], "ans" : "19 you STUPIDDD", "title" : "Whats 9 + 10" }, { "options" : ["its wednesday my dudes", "what the dawg doin", "papa musk"], "questions" : [false, true, false], "ans" : "not papa musk", "title" : "Why are you running?"} ], "ocquestions" : [ {"ans" : "yeet", "explanation" : "it must be yeet", "title" : "ya ... (fill in the gap)"}, {"ans" : "jolle", "explanation" : "joole becayuse he cool af", "title" : "who is long boi?" } ] }'

    // Builds the question card from JSON
    function buildmcquestion(qnum) {
        $('.multiplechoice').eq(qnum).append(`<h1 class="questiontitle">${qobj.mcquestions[qnum].title}</h1>`);
        qobj.mcquestions[qnum].options.forEach(element => {
            $('.multiplechoice').eq(qnum).append(`<div class="ui radio checkbox"><input type="radio" name="mcquestion${qnum}"><label id="checkboxtext">${element}</label></div><br>`)
        });
        $('.multiplechoice').eq(qnum).append(`
            <button class="ui button check" id="checkanswer">Check</button>
            <button class="ui button retry" id="retryanswer" style="display: none;">Opnieuw</button>
            <button class="ui button show" id="showanswer" style="display: none;">Antwoord</button>
        `);
        $('.multiplechoice').eq(qnum).append(`<div class="correctanswer">${qobj.mcquestions[qnum].ans}</div>`);

    };

    // Builds the open question card
    function buildocquestion(qnum) {
        console.log("hmmm");
        $('.openquestion').eq(qnum).append(`<h1 class="questiontitle" name="ocquestion${qnum}">${qobj.ocquestions[qnum].title}</h1>`);
        $('.openquestion').eq(qnum).append('<div class="ui input" style="margin-bottom: 8px;"><input type="text" placeholder="Antwoord" id="ocanswer"></div><br>');
        $('.openquestion').eq(qnum).append(`
            <button class="ui button checkoc" id="checkanswer">Check</button>
            <button class="ui button retryoc" id="retryanswer" style="display: none;">Opnieuw</button>
            <button class="ui button showoc" id="showanswer" style="display: none;">Antwoord</button>
        `);
        $('.openquestion').eq(qnum).append(`<div class="correctanswer">${qobj.ocquestions[qnum].explanation}</div>`);
    };

    function getcorrect(qnum) {
        for (i in Object.keys(qobj.mcquestions[qnum].questions)) {
            if (qobj.mcquestions[qnum].questions[i] === true) {
                return i;
            };
        };
    };

    // Fires when the DOM has finished loading
    $(document).ready( function() {
        
        $('.navbtn').eq(1).css({"background-color": "var(--accent1)", "color": "white"});

        // Parse the string so the program understands the JSON
        qobj = JSON.parse(qobj);

        // Loops through available multiple choice questions in JSON object
        for (i in Object.keys(qobj.mcquestions)) {
            buildmcquestion(i);
        };

        // Does the same for open questions
        for (i in Object.keys(qobj.ocquestions)) {
            buildocquestion(i);
        }

        // Checks if the user answered correctly
        $('.checkoc').click( function() {
            var qnum = getqnum($(this).siblings('.questiontitle').attr('name'));

            if ($(this).siblings('.input').children('input').val() === qobj.ocquestions[qnum].ans) {
                $(this).parent().css('background-color', 'var(--success)');
                $(this).siblings('.showoc').hide();
                $(this).siblings('.retryoc').hide();
                $(this).siblings('.correctanswer').show();
            } else {
                $(this).parent().css('background-color', 'var(--error)');
                $(this).siblings('.showoc').show();
                $(this).siblings('.retryoc').show();
            };
            $(this).hide();
            $(this).siblings('.input').children('input').prop('disabled', true);
        });
        
        // Retry button
        $('.retryoc').click( function() {

            $(this).siblings('.input').children('input').val('');
            $(this).siblings('.input').children('input').prop('disabled', false);
            $(this).hide();
            $(this).siblings('.checkoc').show();
        })

        // Shows the answer to the user
        $('.showoc').click( function() {
            
            var qnum = getqnum($(this).siblings('.questiontitle').attr('name'));
            
            $('#ocanswer').val(qobj.ocquestions[qnum].ans);
            $(this).siblings('.input').children('input').prop('disabled', true);
            $(this).hide();
            $(this).siblings('.check').hide();
            $(this).siblings('.retryoc').hide();
            $(this).parent().css('background-color', 'var(--accent1)');
            $(this).siblings('.correctanswer').show();
        });

        $('.check').click( function() {
            
            // Create a variable which knows which question the user is checking
            var qnum = getqnum($(this).siblings('.radio').eq(0).children('input').attr('name'));

            // Create a variable that holds wether the user answered correctly
            var correct = false;

            // Loop through the available answers
            for (i in Object.keys(qobj.mcquestions[qnum].questions)) {
                
                // Check wether the user has checked the answer and if so, wether the answer the user checked is correct
                if ( $(this).siblings('.radio').eq(i).children('input').is(':checked') && qobj.mcquestions[qnum].questions[i] === true ) {
                    correct = true
                }
                $(this).siblings('.radio').eq(i).children('input').prop('disabled', true)
            };
            
            // If the variable is true, the user has answered correctly
            if (correct === true) {
                $(this).siblings('.correctanswer').show();
                $(this).siblings('.show').hide();
                $(this).parent().css('background-color', 'var(--success)');
                $(this).siblings('.radio').eq( getcorrect(qnum) ).children('input').prop('disabled', false);
                $(this).siblings('.radio').eq( getcorrect(qnum) ).children('label').css('font-weight', 'bold');
            } else {
                $(this).siblings('.retry').show();
                $(this).siblings('.show').show();
                $(this).parent().css('background-color', 'var(--error)');
            }
            $(this).hide();
        });
        
        // Retry button, resets the question so the user can answer again
        $('.retry').click( function() {
            var qnum = getqnum($(this).siblings('.radio').eq(0).children('input').attr('name'));

            for (i in Object.keys(qobj.mcquestions[qnum].questions)) {
                $(this).siblings('.radio').eq(i).children('input').prop('disabled', false)
            };
            $(this).hide();
            $(this).siblings('.check').show();

        });

        // Show button, shows the correct answer and disables user input
        $('.show').click( function() {
            var qnum = getqnum($(this).siblings('.radio').eq(0).children('input').attr('name'));

            for (i in Object.keys(qobj.mcquestions[qnum].questions)) {
                $(this).siblings('.radio').eq(i).children('input').prop('disabled', true);
                $(this).siblings('.radio').eq(i).children('input').prop('checked', false);
            };
            $(this).hide();
            $(this).siblings('.check').hide();
            $(this).siblings('.retry').hide();
            $(this).siblings('.correctanswer').show();
            $(this).parent().css('background-color', 'var(--accent1)');
            $(this).siblings('.radio').eq( getcorrect(qnum) ).children('input').prop('disabled', false);
            $(this).siblings('.radio').eq( getcorrect(qnum) ).children('label').css('font-weight', 'bold');
            $(this).siblings('.radio').eq(i).children('input').prop('checked', true);
        });
    });

    // Simple function which shortens qnum
    function getqnum(qnum) {
        qnum = qnum.slice(-1);
        return qnum
    }

    // ------------------------- To Import The Lessons-----------------------------------------------
    // ------------------------- Needs To Change ----------------------------------------------------

    function getdocs(term) {
        const docs = document.getElementById("docs").value;
        o = JSON.parse(`${docs}`)
        const text = o[`${term}`]
        document.querySelector("#documentation").innerHTML = text

        const documentation = document.getElementById("sidebar")
        documentation.style.display = "block";
        const lesson = document.getElementById("lesson")
        lesson.style.width = "75%";
    }
    function gaweg() {
        const d = document.getElementById("sidebar");
        d.style.display = "none";
        const l = document.getElementById("lesson");
        l.style.width = "70%";
    }

</script>

<style>
    body {
        margin: 0px;
        padding: 0px;
        font-size: 18px;
        font-family: sans-serif;
    }
    #documentation {
        padding: 10px;
    }

    #sidebar {
        width: 35%;
    }

    .button {
        font-weight: bold;
        background-color: transparent;
        border: 0px;
        margin: 0px;
        padding: 0px;
        font-size: 18px;
    }
    #footer {
        position: absolute;
        bottom: 10px;
        right: 10px;
        left: auto;
        top: auto;
    }
    #lesson {
        width: 70%;
        background-color: white;
        margin: auto;
        padding: 10px;
    }
    #body {
        height: 100%;
        background-color: lightgray;
        display: flex;
        overflow: scroll;
    }
    code {
        border: 1px solid lightgray;
        background-color: lightgray;
        
    }

    .multiplechoice {
        background-color: var(--accent1);
        width: 100%;
        height:100%;
        border-radius: 8px;
        padding: 16px;
        box-shadow: var(--shadow-1);
        position: relative;
    }

    .correctanswer {
        display: none;
        color: white;
        font-size: 1.2rem;
    }

    .questiontitle {
        color: white;
        font-size: 2rem;
    }

    #checkboxtext {
        color: white;
        font-size: 1rem;
        font-weight: normal;
    }

    .openquestion {
        background-color: var(--accent1);
        width: 100%;
        height:100%;
        border-radius: 8px;
        padding: 16px;
        box-shadow: var(--shadow-1);
        position: relative;
    }

    .correctocanswer {
        display: none;
        color: white;
        font-size: 1.2rem;
    }

</style>
<div id="body">
    <div id="lesson">
        <div class="openquestion">

        </div>
        <div class="openquestion">
            
        </div>
        <div class="multiplechoice">

        </div>
        <div class="multiplechoice">

        </div>
        <button onclick="get_html(`index`)">kijk!</button>
        {% autoescape off %}
            {{ file.file }}
        {% endautoescape %}
        <form method="post" action="{% url 'progress' %}" style=" width: 100px; margin: auto;">
            {% csrf_token %}
            <input type="hidden" value="{{ file.path }}" name="path">
            <input type="submit" value="completed">
        </form>
    </div>
    <div id="sidebar" style="display: none;">
        <button class="button" onclick="gaweg()"> x </button>
        <div ><a id="link2docs" href="" target="_blank">open in page</a></div>
        <div id="documentation">
            Hi!
        </div>
    </div>
    
</div>

<input type="hidden" id="docs" name="docs" value="{{ docs }}">

<script>
    function get_html(url) {
        fetch(`/docs/${url}`).then(function (response) {
            const r = response.text()
	        return r
        }).then(function (html) {
            console.log(html)
            document.getElementById("documentation").innerHTML = html;
            document.getElementById("link2docs").href = `/docs/link/${url}`;
        }).catch(function (err) {
	        console.warn('Something went wrong.', err);
        });

        const documentation = document.getElementById("sidebar")
        documentation.style.display = "block";
        const lesson = document.getElementById("lesson")
        lesson.style.width = "75%";
    }
</script>

{% endblock %}
